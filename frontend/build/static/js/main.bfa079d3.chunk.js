(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{141:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),s=n(29),u=n.n(s),i=(n(52),n(45)),o=n(145),c=n(142),l=n(143),h=n(144),m=n(17),f=n(18),p=n(22),d=n(19),g=n(23),b=function(t){function e(t){var n;return Object(m.a)(this,e),(n=Object(p.a)(this,Object(d.a)(e).call(this,t))).auth=t.auth,n.state={isAuthenticated:n.auth.isAuthenticated()},n}return Object(g.a)(e,t),Object(f.a)(e,[{key:"login",value:function(){var t=this.refs.input.value.trim();this.auth.authenticate(t||"Guest"),this.setState({isAuthenticated:!0})}},{key:"render",value:function(){var t=this;return this.state.isAuthenticated?r.a.createElement(c.a,{to:{pathname:"/"}}):r.a.createElement("div",{className:"login"},r.a.createElement("input",{autoFocus:!0,type:"text",placeholder:"Guest",ref:"input",onKeyPress:function(e){return"Enter"===e.key&&t.login()}}),r.a.createElement("button",{onClick:function(){return t.login()}},"Login"))}}]),e}(a.Component),E=n(30),v=(n(56),n(24)),O=function(t){function e(t){var n;return Object(m.a)(this,e),(n=Object(p.a)(this,Object(d.a)(e).call(this,t))).state={messages:[]},n.ws=new WebSocket("".concat(Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_BACKEND_WS,"/ws")),n.user=t.auth.user,n}return Object(g.a)(e,t),Object(f.a)(e,[{key:"componentDidMount",value:function(){var t=this;fetch("".concat(Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_BACKEND_URL,"/messages")).then(function(t){return t.json()}).then(function(e){return e.map(function(e){return t.formatMessage(e)})}).then(function(t){return t.reverse()}).then(function(e){return t.setState({messages:e})}).then(function(){t.refs.input.input.focus(),t.ws.onmessage=function(e){var n=t.state.messages,a=t.parseWebsocketFrame(e);t.setState({messages:[].concat(Object(E.a)(n),Object(E.a)(a))})}})}},{key:"sendMessage",value:function(){var t=this.refs.input.state.value;t&&t.trim()&&(this.ws.send(JSON.stringify({text:t.trim(),uid:this.props.auth.user.id,date:new Date,title:this.props.auth.user.name})),this.refs.input.clear())}},{key:"parseWebsocketFrame",value:function(t){var e=this;return t.data.split("\n").map(function(t){return e.formatMessage(JSON.parse(t))})}},{key:"formatMessage",value:function(t){var e=t.text,n=t.uid,a=t.date,r=t.title;return{position:n===this.props.auth.user.id?"right":"left",type:"text",text:e,date:new Date(a),title:r}}},{key:"render",value:function(){var t=this;return r.a.createElement("div",null,r.a.createElement("button",{className:"logout",onClick:function(){return t.props.auth.logout()}},"Logout"),r.a.createElement(v.MessageList,{className:"message-list",lockable:!0,toBottomHeight:"100%",dataSource:this.state.messages}),r.a.createElement(v.Input,{ref:"input",placeholder:"Type here...",multiline:!1,onKeyPress:function(e){return"Enter"===e.key&&t.sendMessage()},rightButtons:r.a.createElement(v.Button,{color:"white",backgroundColor:"black",text:"Send",onClick:function(){return t.sendMessage()}})}))}}]),e}(a.Component),k={user:null,authenticate:function(t){this.user={name:t,id:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},localStorage.setItem("dito-chat-user",JSON.stringify(this.user))},logout:function(){localStorage.removeItem("dito-chat-user"),this.user=null,window.location.reload()},isAuthenticated:function(){if(null!==this.user)return!0;var t=localStorage.getItem("dito-chat-user");return null!=t&&(this.user=JSON.parse(t),!0)}},j=function(t){var e=t.component,n=Object(i.a)(t,["component"]);return r.a.createElement(o.a,Object.assign({},n,{render:function(t){return k.isAuthenticated()?r.a.createElement(e,Object.assign({},t,{auth:k})):r.a.createElement(c.a,{to:{pathname:"/login"}})}}))},y=function(){return r.a.createElement(l.a,null,r.a.createElement(h.a,null,r.a.createElement(o.a,{path:"/login",render:function(t){return r.a.createElement(b,Object.assign({},t,{auth:k}))}}),r.a.createElement(j,{path:"/",component:O})))};u.a.render(r.a.createElement(y,null),document.getElementById("root"))},47:function(t,e,n){t.exports=n(141)},52:function(t,e,n){}},[[47,1,2]]]);
//# sourceMappingURL=main.bfa079d3.chunk.js.map
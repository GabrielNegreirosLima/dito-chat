{"version":3,"sources":["Login.js","Chat.js","auth.js","App.js","index.js"],"names":["Login","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","auth","state","isAuthenticated","name","refs","input","value","trim","authenticate","setState","_this2","react_default","a","createElement","Redirect","to","pathname","className","autoFocus","type","placeholder","ref","onKeyPress","_ref","key","login","onClick","Component","Chat","messages","ws","WebSocket","concat","process","REACT_APP_BACKEND_WS","user","fetch","REACT_APP_BACKEND_URL","then","response","json","map","message","formatMessage","reverse","focus","onmessage","frame","newMessages","parseWebsocketFrame","toConsumableArray","send","JSON","stringify","text","uid","id","date","Date","title","clear","_this3","data","split","parse","position","_this4","logout","dist_main","lockable","toBottomHeight","dataSource","multiline","_ref2","sendMessage","rightButtons","color","backgroundColor","Math","random","toString","substring","localStorage","setItem","removeItem","window","location","reload","cache","getItem","PrivateRoute","component","rest","objectWithoutProperties","Route","assign","render","App","BrowserRouter","Switch","path","src_Login","App_PrivateRoute","ReactDOM","src_App","document","getElementById"],"mappings":"kOA8CeA,cA1Cb,SAAAA,EAAYC,GAAO,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAL,IACjBE,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAH,GAAAQ,KAAAH,KAAMJ,KACDQ,KAAOR,EAAMQ,KAClBP,EAAKQ,MAAQ,CACXC,gBAAiBT,EAAKO,KAAKE,mBAJZT,uEASjB,IAAMU,EAAOP,KAAKQ,KAAKC,MAAMC,MAAMC,OACnCX,KAAKI,KAAKQ,aAAaL,GAAQ,SAC/BP,KAAKa,SAAS,CAAEP,iBAAiB,qCAG1B,IAAAQ,EAAAd,KAGP,OAF4BA,KAAKK,MAAzBC,gBAIJS,EAAAC,EAAAC,cAACC,EAAA,EAAD,CACEC,GAAI,CACFC,SAAU,OAOhBL,EAAAC,EAAAC,cAAA,OAAKI,UAAU,SACbN,EAAAC,EAAAC,cAAA,SACEK,WAAS,EACTC,KAAK,OACLC,YAAY,QACZC,IAAI,QACJC,WAAY,SAAAC,GAAA,MAAqB,UAArBA,EAAGC,KAA6Bd,EAAKe,WAEnDd,EAAAC,EAAAC,cAAA,UAAQa,QAAS,kBAAMhB,EAAKe,UAA5B,iBArCYE,qCC4FLC,cAzFb,SAAAA,EAAYpC,GAAO,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAgC,IACjBnC,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAkC,GAAA7B,KAAAH,KAAMJ,KACDS,MAAQ,CACX4B,SAAU,IAGZpC,EAAKqC,GAAK,IAAIC,UAAJ,GAAAC,OAAiBC,8CAAYC,qBAA7B,QACVzC,EAAK0C,KAAO3C,EAAMQ,KAAKmC,KAPN1C,mFAUC,IAAAiB,EAAAd,KAClBwC,MAAK,GAAAJ,OAAIC,8CAAYI,sBAAhB,cACFC,KAAK,SAAAC,GAAQ,OAAIA,EAASC,SAC1BF,KAAK,SAAAT,GAAQ,OAAIA,EAASY,IAAI,SAAAC,GAAO,OAAIhC,EAAKiC,cAAcD,OAC5DJ,KAAK,SAAAT,GAAQ,OAAIA,EAASe,YAC1BN,KAAK,SAAAT,GAAQ,OAAInB,EAAKD,SAAS,CAAEoB,eACjCS,KAAK,WACJ5B,EAAKN,KAAKC,MAAMA,MAAMwC,QACtBnC,EAAKoB,GAAGgB,UAAY,SAAAC,GAAS,IACnBlB,EAAanB,EAAKT,MAAlB4B,SAEFmB,EAActC,EAAKuC,oBAAoBF,GAE7CrC,EAAKD,SAAS,CAAEoB,SAAQ,GAAAG,OAAAtC,OAAAwD,EAAA,EAAAxD,CAAMmC,GAANnC,OAAAwD,EAAA,EAAAxD,CAAmBsD,+CAMjD,IAAM1C,EAAQV,KAAKQ,KAAKC,MAAMJ,MAAMK,MAChCA,GAASA,EAAMC,SACjBX,KAAKkC,GAAGqB,KACNC,KAAKC,UAAU,CACbC,KAAMhD,EAAMC,OACZgD,IAAK3D,KAAKJ,MAAMQ,KAAKmC,KAAKqB,GAC1BC,KAAM,IAAIC,KACVC,MAAO/D,KAAKJ,MAAMQ,KAAKmC,KAAKhC,QAGhCP,KAAKQ,KAAKC,MAAMuD,qDAIAb,GAAO,IAAAc,EAAAjE,KAEzB,OADamD,EAAMe,KAAKC,MAAM,MAClBtB,IAAI,SAAAD,GAAI,OAAIqB,EAAKlB,cAAcS,KAAKY,MAAMxB,+CAGd,IAA1Bc,EAA0B/B,EAA1B+B,KAAMC,EAAoBhC,EAApBgC,IAAKE,EAAelC,EAAfkC,KAAME,EAASpC,EAAToC,MAC/B,MAAO,CACLM,SAAUV,IAAQ3D,KAAKJ,MAAMQ,KAAKmC,KAAKqB,GAAK,QAAU,OACtDrC,KAAM,OACNmC,OACAG,KAAM,IAAIC,KAAKD,GACfE,0CAIK,IAAAO,EAAAtE,KACP,OACEe,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,UAAQI,UAAU,SAASS,QAAS,kBAAMwC,EAAK1E,MAAMQ,KAAKmE,WAA1D,UAGAxD,EAAAC,EAAAC,cAACuD,EAAA,YAAD,CACEnD,UAAU,eACVoD,UAAU,EACVC,eAAgB,OAChBC,WAAY3E,KAAKK,MAAM4B,WAEzBlB,EAAAC,EAAAC,cAACuD,EAAA,MAAD,CACE/C,IAAI,QACJD,YAAY,eACZoD,WAAW,EACXlD,WAAY,SAAAmD,GAAA,MAAqB,UAArBA,EAAGjD,KAA6B0C,EAAKQ,eACjDC,aACEhE,EAAAC,EAAAC,cAACuD,EAAA,OAAD,CACEQ,MAAM,QACNC,gBAAgB,QAChBvB,KAAK,OACL5B,QAAS,kBAAMwC,EAAKQ,2BAjFf/C,aCkCJ3B,EA7BF,CACXmC,KAAM,KACN3B,aAFW,SAEEL,GACXP,KAAKuC,KAAO,CACVhC,OACAqD,GAZJsB,KAAKC,SACFC,SAAS,IACTC,UAAU,EAAG,IAChBH,KAAKC,SACFC,SAAS,IACTC,UAAU,EAAG,KASdC,aAAaC,QAjBA,iBAiBkB/B,KAAKC,UAAUzD,KAAKuC,QAGrDgC,OAVW,WAWTe,aAAaE,WArBA,kBAsBbxF,KAAKuC,KAAO,KACZkD,OAAOC,SAASC,UAGlBrF,gBAhBW,WAiBT,GAAkB,OAAdN,KAAKuC,KAAe,OAAO,EAE/B,IAAMqD,EAAQN,aAAaO,QA7Bd,kBA8Bb,OAAa,MAATD,IACF5F,KAAKuC,KAAOiB,KAAKY,MAAMwB,IAChB,KCpBPE,EAAe,SAAAnE,GAAA,IAAcI,EAAdJ,EAAGoE,UAAyBC,EAA5BlG,OAAAmG,EAAA,EAAAnG,CAAA6B,EAAA,sBACnBZ,EAAAC,EAAAC,cAACiF,EAAA,EAADpG,OAAAqG,OAAA,GACMH,EADN,CAEEI,OAAQ,SAAAxG,GAAK,OACXQ,EAAKE,kBACHS,EAAAC,EAAAC,cAACc,EAADjC,OAAAqG,OAAA,GAAevG,EAAf,CAAsBQ,KAAMA,KAE5BW,EAAAC,EAAAC,cAACC,EAAA,EAAD,CACEC,GAAI,CACFC,SAAU,iBAiBPiF,EATH,kBACVtF,EAAAC,EAAAC,cAACqF,EAAA,EAAD,KACEvF,EAAAC,EAAAC,cAACsF,EAAA,EAAD,KACExF,EAAAC,EAAAC,cAACiF,EAAA,EAAD,CAAOM,KAAK,SAASJ,OAAQ,SAAAxG,GAAK,OAAImB,EAAAC,EAAAC,cAACwF,EAAD3G,OAAAqG,OAAA,GAAWvG,EAAX,CAAkBQ,KAAMA,QAC9DW,EAAAC,EAAAC,cAACyF,EAAD,CAAcF,KAAK,IAAIT,UAAW/D,OC5BxC2E,IAASP,OAAOrF,EAAAC,EAAAC,cAAC2F,EAAD,MAASC,SAASC,eAAe","file":"static/js/main.bfa079d3.chunk.js","sourcesContent":["import React, { Component } from \"react\";\nimport { Redirect } from \"react-router-dom\";\n\nclass Login extends Component {\n  constructor(props) {\n    super(props);\n    this.auth = props.auth;\n    this.state = {\n      isAuthenticated: this.auth.isAuthenticated()\n    };\n  }\n\n  login() {\n    const name = this.refs.input.value.trim();\n    this.auth.authenticate(name || \"Guest\");\n    this.setState({ isAuthenticated: true });\n  }\n\n  render() {\n    const { isAuthenticated } = this.state;\n\n    if (isAuthenticated) {\n      return (\n        <Redirect\n          to={{\n            pathname: \"/\"\n          }}\n        />\n      );\n    }\n\n    return (\n      <div className=\"login\">\n        <input\n          autoFocus\n          type=\"text\"\n          placeholder=\"Guest\"\n          ref=\"input\"\n          onKeyPress={({ key }) => key === 'Enter' && this.login()}\n        />\n        <button onClick={() => this.login()}>Login</button>\n      </div>\n    );\n  }\n}\n\nexport default Login;\n","import \"react-chat-elements/dist/main.css\";\n\nimport React, { Component } from \"react\";\nimport { MessageList, Input, Button } from \"react-chat-elements\";\n\nclass Chat extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      messages: []\n    };\n\n    this.ws = new WebSocket(`${process.env.REACT_APP_BACKEND_WS}/ws`);\n    this.user = props.auth.user;\n  }\n\n  componentDidMount() {\n    fetch(`${process.env.REACT_APP_BACKEND_URL}/messages`)\n      .then(response => response.json())\n      .then(messages => messages.map(message => this.formatMessage(message)))\n      .then(messages => messages.reverse())\n      .then(messages => this.setState({ messages }))\n      .then(() => {\n        this.refs.input.input.focus();\n        this.ws.onmessage = frame => {\n          const { messages } = this.state;\n\n          const newMessages = this.parseWebsocketFrame(frame);\n\n          this.setState({ messages: [...messages, ...newMessages] });\n        };\n      });\n  }\n\n  sendMessage() {\n    const value = this.refs.input.state.value;\n    if (value && value.trim()) {\n      this.ws.send(\n        JSON.stringify({\n          text: value.trim(),\n          uid: this.props.auth.user.id,\n          date: new Date(),\n          title: this.props.auth.user.name\n        })\n      );\n      this.refs.input.clear();\n    }\n  }\n\n  parseWebsocketFrame(frame) {\n    const data = frame.data.split(\"\\n\");\n    return data.map(json => this.formatMessage(JSON.parse(json)));\n  }\n\n  formatMessage({ text, uid, date, title }) {\n    return {\n      position: uid === this.props.auth.user.id ? \"right\" : \"left\",\n      type: \"text\",\n      text,\n      date: new Date(date),\n      title\n    };\n  }\n\n  render() {\n    return (\n      <div>\n        <button className=\"logout\" onClick={() => this.props.auth.logout()}>\n          Logout\n        </button>\n        <MessageList\n          className=\"message-list\"\n          lockable={true}\n          toBottomHeight={\"100%\"}\n          dataSource={this.state.messages}\n        />\n        <Input\n          ref=\"input\"\n          placeholder=\"Type here...\"\n          multiline={false}\n          onKeyPress={({ key }) => key === \"Enter\" && this.sendMessage()}\n          rightButtons={\n            <Button\n              color=\"white\"\n              backgroundColor=\"black\"\n              text=\"Send\"\n              onClick={() => this.sendMessage()}\n            />\n          }\n        />\n      </div>\n    );\n  }\n}\n\nexport default Chat;\n","const USER_KEY = \"dito-chat-user\";\n\nconst generateId = () =>\n  Math.random()\n    .toString(36)\n    .substring(2, 15) +\n  Math.random()\n    .toString(36)\n    .substring(2, 15);\n\nconst auth = {\n  user: null,\n  authenticate(name) {\n    this.user = {\n      name,\n      id: generateId()\n    };\n    localStorage.setItem(USER_KEY, JSON.stringify(this.user));\n  },\n\n  logout() {\n    localStorage.removeItem(USER_KEY);\n    this.user = null;\n    window.location.reload();\n  },\n\n  isAuthenticated() {\n    if (this.user !== null) return true;\n\n    const cache = localStorage.getItem(USER_KEY);\n    if (cache != null) {\n      this.user = JSON.parse(cache);\n      return true;\n    }\n\n    return false;\n  }\n};\n\nexport default auth;\n","import React from \"react\";\nimport {\n  BrowserRouter as Router,\n  Route,\n  Switch,\n  Redirect\n} from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Chat from \"./Chat\";\n\nimport auth from \"./auth\";\n\nconst PrivateRoute = ({ component: Component, ...rest }) => (\n  <Route\n    {...rest}\n    render={props =>\n      auth.isAuthenticated() ? (\n        <Component {...props} auth={auth} />\n      ) : (\n        <Redirect\n          to={{\n            pathname: \"/login\"\n          }}\n        />\n      )\n    }\n  />\n);\n\nconst App = () => (\n  <Router>\n    <Switch>\n      <Route path=\"/login\" render={props => <Login {...props} auth={auth} />} />\n      <PrivateRoute path=\"/\" component={Chat} />\n    </Switch>\n  </Router>\n);\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}